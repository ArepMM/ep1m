#include    "pressure-sensor.h"

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
PressureSensor::PressureSensor(QObject *parent) : Device(parent)
  , p_in(0.0)
  , p_ref(0.0)
  , Vk(0.002)
  , K1(0.01)
{

}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
PressureSensor::~PressureSensor()
{

}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void PressureSensor::preStep(state_vector_t &Y, double t)
{
    Q_UNUSED(Y)
    Q_UNUSED(t)
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void PressureSensor::ode_system(const state_vector_t &Y,
                                state_vector_t &dYdt,
                                double t)
{
    Q_UNUSED(t)

    dYdt[0] = K1 * (p_in - Y[0]) / Vk;
}

//------------------------------------------------------------------------------
//
//------------------------------------------------------------------------------
void PressureSensor::load_config(CfgReader &cfg)
{
    QString secName = "Device";

    cfg.getDouble(secName, "Vk", Vk);
    cfg.getDouble(secName, "K1", K1);
    cfg.getDouble(secName, "p_ref", p_ref);
}
